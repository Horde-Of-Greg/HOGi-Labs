name: Bump, Build and Publish on Push to master

on:
  push:
    branches:
      - master
    paths-ignore:
      - ".gitignore"
      - ".github/**"
      - "README.md"
      - "LICENSE"
      - "CONTRIBUTING.md"
      - "CODE_OF_CONDUCT.md"

permissions:
  contents: write

concurrency:
  group: on-push-${{ github.ref }}
  cancel-in-progress: true

jobs:
  bump:
    name: Dispatch Bump Version
    if: ${{ github.event.sender.type != 'Bot' && !endsWith(github.actor, '[bot]') && github.actor != 'dependabot[bot]' }}
    uses: ./.github/workflows/bump.yml
    secrets: inherit

  build:
    name: Dispatch Build Mod
    if: ${{ github.event.sender.type != 'Bot' && !endsWith(github.actor, '[bot]') && github.actor != 'dependabot[bot]' }}
    needs: bump
    uses: ./.github/workflows/build.yml
    secrets: inherit

  publish:
    name: Dispatch Publishing
    if: ${{ github.event.sender.type != 'Bot' && !endsWith(github.actor, '[bot]') && github.actor != 'dependabot[bot]' }}
    needs: [build, bump]
    uses: ./.github/workflows/publish.yml
    with:
      release_tag: ${{ needs.bump.outputs.release_tag }}
      publish-to-gh: true
      publish-to-cf: true
      publish-to-mr: true
    secrets: inherit
